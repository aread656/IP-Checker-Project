<!DOCTYPE html>
<html>
<head>
<title>IPAddressChecker</title>

<script type="text/javascript">

let config = {};
fetch("config.json")
    .then(response => response.json())
    .then(json => {config = json;})

function displayTotalIP(total_ips)
{
    document.getElementById('output-text').value = 'Total IP addresses = ' + total_ips;
}

function displayTotalEmpty(total_empty_ips)
{
    document.getElementById('output-text').value = 'Total empty IP addresses = ' + total_empty_ips;
}

function displayTotalValid(total_valid_ips)
{
    document.getElementById('output-text').value = 'Total valid IP addresses = ' + total_valid_ips;
}

function displayTotalBadGood(total_bad_good){
    document.getElementById('output-text').value = 'Good/bad IP addresses = ' + total_bad_good;
}

function displayIPClassifications(ip_classifications){
    document.getElementById('output-text').value = 'IPClassifications = ' + ip_classifications;
}
function displayIPCountries(country_ips){
        document.getElementById('output-text').value = 'IP Countries = ' + country_ips;

}

function clearText()
{
    document.getElementById('input-text').value = '';
    document.getElementById('output-text').value = '';
}

function getTotalIPs(){
  //read items
  let items = document.getElementById('input-text').value
  //alert if none given
  if (!items){
    alert("Please enter some items")
    return;
  }
  // make http req
  let xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState != 4){
      return;
    }
    if(this.status != 200){
      alert("Error: backend service status " + this.status);
      return;
    } 
    //catch incorrect JSON
    try{var j = JSON.parse(this.response)}
    catch (e){
      alert("Invalid JSON returned by backend: " + e)
      return;
    };
    //broader check for json errors, catch-all
    if (j.error){
      alert("JSON returned an error" + j.error)
      return;
    }
    console.log('test -- ' + j.total_ips);
    let total_ips = j.total_ips;
    displayTotalIP(total_ips);
  };
  //catch-all httpreq error
  xhttp.onerror=function(){
    alert("Backend communication error occurred")
    return;
  }
  xhttp.open("GET",config.totalIPURL+"?items=" + encodeURIComponent(items));
  xhttp.send();
  return;
}

function getTotalEmptyIPs()
{
  let items = document.getElementById('input-text').value
  if (!items){
    alert("Please enter some items")
    return;
  }
  let xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState != 4){
      return;
    }
    if(this.status != 200){
    alert("Error: backend service status " + this.status);
    return;
    } 
    //catch incorrect JSON
    try{var j = JSON.parse(this.response)}
    catch (e){
      alert("Invalid JSON returned by backend: " + e)
      return;
    };
    //broader check for json errors, catch-all
    if (j.error){
      alert("JSON returned an error" + j.error)
      return;
    }
    console.log('test -- ' + j.total_empty_ips);
    let total_empty_ips = j.total_empty_ips;
    displayTotalEmpty(total_empty_ips);
  }
  xhttp.onerror=function(){
    alert("Backend communication error occurred")
    return;
  }
  xhttp.open("GET",config.totalEmptyIPURL+"?items=" + encodeURIComponent(items));
  xhttp.send();
  return;
}
encodeUR
function getTotalValidIPs(){
  //read items
  let items = document.getElementById('input-text').value
  //alert if none given
  if (!items){
    alert("Please enter some items")
    return;
  }
  // make http req
  let xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState != 4){
      return;
    }
    if(this.status != 200){
      alert("Error: backend service status " + this.status);
      return;
    } 
    //catch incorrect JSON
    try{var j = JSON.parse(this.response)}
    catch (e){
      alert("Invalid JSON returned by backend: " + e)
      return;
    };
    //broader check for json errors, catch-all
    if (j.error){
      alert("JSON returned an error: " + j.error)
      return;
    }
    console.log('test -- ' + j.totalValid);
    let total_valid_ips = j.totalValid;
    displayTotalValid(total_valid_ips);
  };
  //catch-all httpreq error
  xhttp.onerror=function(){
    alert("Backend communication error occurred")
    console.error("Backend comm error");
    return;
  }
  xhttp.open("GET",config.totalValidIPURL+"?items=" + encodeURIComponent(items));
  xhttp.send();
  return;
}

function findBadIPs(){
    //read items
  let items = document.getElementById('input-text').value
  //alert if none given
  if (!items){
    alert("Please enter some items")
    return;
  }
  // make http req
  let xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState != 4){
      return;
    }
    if(this.status != 200){
      alert("Error: backend service status " + this.status);
      return;
    } 
    //catch incorrect JSON
    try{var j = JSON.parse(this.response)}
    catch (e){
      alert("Invalid JSON returned by backend: " + e)
      return;
    };
    //broader check for json errors, catch-all
    if (j.error){
      alert("JSON returned an error: " + j.error + ". Check for non-hex characters")
      return;
    }
    console.log('test -- ' + j.total_valid_ips);
    let good_bad_array = j.answer;
    displayTotalBadGood(good_bad_array);
  };
  //catch-all httpreq error
  xhttp.onerror=function(){
    alert("Backend communication error occurred")
    return;
  }
  xhttp.open("GET",config.badIPURL+"?items=" + encodeURIComponent(items));
  xhttp.send();
  return;
}

function classifyIPs(){
    let items = document.getElementById('input-text').value
    if (!items){
      alert("Please enter some items")
      return;
    }
  // make http req
  let xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState != 4){
      return;
    }
    if(this.status != 200){
      alert("Error: backend service status " + this.status);
      return;
    }
    //catch incorrect JSON
    try{var j = JSON.parse(this.response)}
    catch (e){
      alert("Invalid JSON returned by backend: " + e)
      return;
    };
    //broader check for json errors, catch-all
    if (j.error){
      alert("JSON returned an error: " + j.error + ". Please enter hex characters only")
      return;
    }
    console.log('test -- ' + j.answer);
    let ip_classifications = j.answer;
    displayIPClassifications(ip_classifications);
  };
  //catch-all httpreq error
  xhttp.onerror=function(){
    alert("Backend communication error occurred")
    return;
  }
  xhttp.open("GET",config.classifierIPURL+"?items=" + encodeURIComponent(items));
  xhttp.send();
  return;
}

function findCountry(){
    let items = document.getElementById('input-text').value
    if (!items){
      alert("Please enter some items")
      return;
    }
  // make http req
  let xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState != 4){
      return;
    }
    if(this.status != 200){
      alert("Error: backend service status " + this.status);
      return;
    } 
    //catch incorrect JSON
    try{var j = JSON.parse(this.response)}
    catch (e){
      alert("Invalid JSON returned by backend: " + e)
      return;
    };
    //broader check for json errors, catch-all
    if (j.error){
      alert("JSON returned an error: " + j.error)
      return;
    }
    console.log('test -- ' + j.answer);
    let ip_countries = j.answer;
    displayIPCountries(ip_countries);
  };
  //catch-all httpreq error
  xhttp.onerror=function(){
    alert("Backend communication error occurred")
  return;
  }
  xhttp.open("GET",config.countryIPURL+"?items=" + encodeURIComponent(items));
  xhttp.send();
  return;
}


</script>

<style type="text/css">
body  {
    font-size: 150%;
    font-family: monospace;
}
label {
    display: inline-block;
    width: 150px;
    text-align: left;
}
#logo
{
    font-family: Calibri, sans-serif;
    font-weight: lighter;
    font-size: 30px;
    color: #505050;
    margin: 0.5em;
}
#normal-text
{
    font-family: Calibri, sans-serif;
    font-size: 20px;
    margin: 0.5em;
}
#ipcheck
{
    text-align: center;
    margin-top: 1em;
}
#input-div
{
    text-align: center;
    margin-top: 1em;
    background-color:#d5d8dc  ;
}
#output-div
{
    text-align: center;
    background-color:#808b96 ;
}

.input-items {
      font-size: 90%;
      color: black;
      background-color:white ;
      padding: 0.2em;
      margin: 0.2em;
      font-family: monospace;
      letter-spacing: 0.1em;
      width: 600px;

  }

.display-output {
    font-size: 90%;
    color: black;
    background-color:white ;
    padding: 0.2em;
    margin: 0.2em;
    font-family: monospace;
    letter-spacing: 0.1em;
    width: 600px;

}

.button-active {
    background-color:   #2874a6  ;
    color: white;
    padding: 0px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 18px;
    margin: 4px 2px;
    cursor: pointer;
    height: 50px;
    width: 400px;
}

.button-inactive {
    background-color: gray;
    color: white;
    padding: 0px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 18px;
    margin: 4px 2px;
    cursor: pointer;
    height: 50px;
    width: 400px;
}

.button-clear {
    background-color:  #c0392b ;
    color: white;
    padding: 0px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 18px;
    margin: 4px 2px;
    cursor: pointer;
    height: 40px;
    width: 400px;
}

</style>

</head>
<body>
<div id="ipcheck">
    <div id="logo">
        IP Address Checker
    </div>
    <div id="input-div">
        <p id="normal-text">
          Paste your IP addresses here (separated by commas)..
        </p>
        <textarea class="input-items" id="input-text" rows="5" cols="35" placeholder="Paste your IP addresses here.." value="">
        </textarea>
    </div>
    <div id="output-div">
       <p id="normal-text">
          Results
        </p>
        <textarea class="display-output" id="output-text" rows="5" cols="35" readonly=1 placeholder="Results here..." value="">
        </textarea>
    </div>
    <div>
        <button class="button-active" onclick="getTotalIPs();">Total IP addresses</button>
    </div>
    <div>
        <button class="button-active" onclick="getTotalEmptyIPs();">Total empty IP addresses</button>
    </div>
    <div>
        <button class="button-active" onclick="getTotalValidIPs();">Total valid IP addresses</button>
    </div>
    <div>
        <button class="button-active" onclick="classifyIPs();">Classify between IPv4 and IPv6</button>
    </div>
    <div>
        <button class="button-active" onclick="findCountry();">Find country information</button>
    </div>
    <div>
        <button class="button-active" onclick="findBadIPs();">Find bad IP addresses</button>
    </div>
    <div>
        <button class="button-clear" onclick="clearText();">Clear</button>
    </div>

</div>
</body>

<script type="text/javascript">
</script>

</html>
